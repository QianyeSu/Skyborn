# .readthedocs.yml
# Read the Docs configuration file
# See https://docs.readthedocs.io/en/stable/config-file/v2.html for details

version: 2

build:
  os: ubuntu-22.04
  tools:
    python: "3.10"
  commands:
    # Install dependencies
    - python -m pip install --upgrade pip setuptools wheel
    - python -m pip install -r requirements-docs.txt
    - python -m pip install -e .
    # Build documentation with custom script
    - export LC_ALL=C.UTF-8 && export LANG=C.UTF-8 && cd docs && python build_docs.py --clean
    # Copy to output directory
    - mkdir -p $READTHEDOCS_OUTPUT/html
    - cp -r docs/build/html/* $READTHEDOCS_OUTPUT/html/
    # Create a redirect index.html at root level if needed
    - |
      cat > $READTHEDOCS_OUTPUT/html/index.html << 'EOF'
      <!DOCTYPE html>
      <html lang="en">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Skyborn Documentation</title>
          <meta http-equiv="refresh" content="0; url=entrance.html">
          <script>
              // Immediate redirect for better user experience
              window.location.href = 'entrance.html';
          </script>
      </head>
      <body>
          <p>Redirecting to <a href="entrance.html">Skyborn Documentation</a>...</p>
      </body>
      </html>
      EOF
    # Move the particle effect page to entrance.html
    - mv $READTHEDOCS_OUTPUT/html/index.html $READTHEDOCS_OUTPUT/html/entrance.html || echo "Move failed"
    - |
      cat > $READTHEDOCS_OUTPUT/html/index.html << 'EOF'
      <!DOCTYPE html>
      <html lang="en">
      <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Skyborn Documentation</title>
          <meta http-equiv="refresh" content="0; url=entrance.html">
          <script>
              window.location.href = 'entrance.html';
          </script>
      </head>
      <body>
          <p>Redirecting to <a href="entrance.html">Skyborn Documentation</a>...</p>
      </body>
      </html>
      EOF
    - echo "‚úÖ Custom build completed with particle effect homepage"
    # Debug: Check what files were copied
    - echo "üìÅ Files in output directory:"
    - ls -la $READTHEDOCS_OUTPUT/html/
    - echo "üîç Content of index.html (first 5 lines):"
    - head -5 $READTHEDOCS_OUTPUT/html/index.html
    - echo "üîç Checking if particles-canvas exists in index.html:"
    - grep -c "particles-canvas" $READTHEDOCS_OUTPUT/html/index.html || echo "‚ùå particles-canvas not found"
